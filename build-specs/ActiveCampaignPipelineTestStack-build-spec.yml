version: 0.2

env:
  git-credential-helper: yes

phases:
  install:
    commands:
      - npm install -g npm || npm -g install yarn
      - yarn install --frozen-lockfile
      - git --version
  pre_build:
    commands:
      - git init --quite
      - git add -A .
  build:
    commands:
      - yarn test
      - yarn cdk synthesize ActiveCampaignPipelineTestStack
      - yarn bump
      - git push --follow-tags origin v1-main

artifacts:
  base-directory: cdk.out
  files:
    - '**.*'
